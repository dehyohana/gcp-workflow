main:
  params: [input]
  steps:
    - checkSearchTermInput:
        switch:
          - condition: '${"searchTerm" in input}'
            assign:
              - searchTerm: "${input.searchTerm}"
            next: checkLanguageInInput
    - checkLanguageInInput:
        switch:
          - condition: '${"language" in input}'
            assign:
              - language: '${input.language}'
            next: getLocation
          - condition: '${"language" not in input}'
            next: getLocationDefaultLanguage
    - getLocation:
        call: sys.get_env
        args:
          name: GOOGLE_CLOUD_LOCATION
        result: location
    - setFromCallResult:
        assign:
          - searchTerm: '${text.split(location, "-")[0]}'
        next: readWikipedia
    - getLocationDefaultLanguage:
        call: sys.get_env
        args:
          name: GOOGLE_CLOUD_LOCATION
        result: location
    - setFromCallResultDefaultLanguage:
        assign:
          - searchTerm: '${text.split(location, "-")[0]}'
        next: readWikipediaDefaultLanguage
    - readWikipedia:
        call: http.get
        args:
          url: '${"https://" + language + ".wikipedia.org/w/api.php"}'
          query:
            action: opensearch
            search: '${searchTerm}'
        result: wikiResult
    - returnOutput:
        return: '${wikiResult.body[1]}'
    - readWikipediaDefaultLanguage:
        call: http.get
        args:
          url: 'https://en.wikipedia.org/w/api.php'
          query:
            action: opensearch
            search: '${searchTerm}'
        result: wikiResult
    - returnOutputDefaultLanguage:
        return: '${wikiResult.body[1]}'
