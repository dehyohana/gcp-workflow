main:
  params: [input]
  steps:
    - checkSearchTermInput:
      switch:
        - condition: '${"searchTerm" in input}'
          assign:
            - searchTerm: "${input.searchTerm}"
          next: checkLanguageInInput
    - checkLanguageInInput:
      switch:
        - condition: "${input.language != null}"
          assign:
            - language: "${input.language}"
          next: readWikipedia
        - condition: "${input.language == null}"
          next: readWikipediaDefaultLanguage
    - getLocation:
      call: sys.get_env
      args:
        name: GOOGLE_CLOUD_LOCATION
      result: location
    - setFromCallResult:
        assign:
            - searchTerm: '${text.split(location, "-")[0]}'
    - readWikipedia:
      call: http.get
      args:
        url: '${"https://" + language + ".wikipedia.org/w/api.php"}'
        query:
          action: opensearch
          search: "${searchTerm}"
      result: wikiResult
    - returnOutput:
      return: "${wikiResult.body[1]}"
    - readWikipediaWithDefaultLanguage:
      call: http.get
      args:
        url: '${"https://en.wikipedia.org/w/api.php"}'
        query:
          action: opensearch
          search: "${searchTerm}"
          language: "en"
      result: wikiResult

